{% extends "base.html" %}

{% block title %}订单统计图表 - EV-MES{% endblock %}
{% block page_title %}订单统计图表{% endblock %}

{% block page_actions %}
<a href="{{ url_for('order.page_order_list') }}" class="btn btn-outline-secondary">
    <i class="fas fa-arrow-left me-1"></i>返回列表
</a>
{% endblock %}

{% block content %}
<!-- 订单数据汇总 -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-area me-2"></i>订单数据汇总
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3 col-sm-6">
                        <div class="card bg-primary text-white text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                                <h3 class="card-title">{{ orders|length }}</h3>
                                <p class="card-text mb-0">总订单数</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="card bg-warning text-dark text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-plus-circle fa-2x mb-2"></i>
                                <h3 class="card-title">
                                    {% set new_count = orders|selectattr('status', 'equalto', 'NEW')|list|length %}
                                    {{ new_count }}
                                </h3>
                                <p class="card-text mb-0">新建订单</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="card bg-info text-white text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-clock fa-2x mb-2"></i>
                                <h3 class="card-title">
                                    {% set review_count = orders|selectattr('status', 'equalto', 'REVIEW')|list|length %}
                                    {{ review_count }}
                                </h3>
                                <p class="card-text mb-0">审核中</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="card bg-success text-white text-center h-100">
                            <div class="card-body">
                                <i class="fas fa-check-circle fa-2x mb-2"></i>
                                <h3 class="card-title">
                                    {% set completed_count = orders|selectattr('status', 'equalto', 'COMPLETED')|list|length %}
                                    {{ completed_count }}
                                </h3>
                                <p class="card-text mb-0">已完成</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 订单状态分布饼图和客户订单数量TOP10柱状图 -->
<div class="row">
    <!-- 订单状态分布饼图 -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-pie me-2"></i>订单状态分布
                </h5>
            </div>
            <div class="card-body">
                {% if status_chart and status_chart.startswith('data:image') %}
                    <div class="text-center">
                        <img src="{{ status_chart }}" class="img-fluid" alt="订单状态分布图" style="max-height: 350px;">
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">暂无数据</h5>
                        <p class="text-muted">请先添加订单数据</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- 客户订单数量TOP10柱状图 -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-bar me-2"></i>客户订单数量TOP10
                </h5>
            </div>
            <div class="card-body">
                {% if customer_chart and customer_chart.startswith('data:image') %}
                    <div class="text-center">
                        <img src="{{ customer_chart }}" class="img-fluid" alt="客户订单数量TOP10图" style="max-height: 350px;">
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">暂无数据</h5>
                        <p class="text-muted">请先添加订单数据</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}
